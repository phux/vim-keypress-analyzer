# Vim Keypress Analyzer

`vim-keypress-analyzer` parses vim keypress log files generated by
`(n)vim -w <a_log_file>` and aggregates key press counts and some antipattern analysis.

## Table of contents

* [Example output](#example-output)
* [Features](#features)
* [Install](#install)
  * [Binary from GitHub release](#binary-from-github-release)
* [Usage](#usage)
  * [Collecting keypresses in vim/nvim](#collecting-keypresses-in-vim/nvim)
  * [Analyzing logfiles](#analyzing-logfiles)
  * [Optional flags](#optional-flags)
* [Motivation](#motivation)
* [TODO](#todo)

## Example output

```sh
$ vim-keypress-analyzer --file ~/.nvim_keylog --limit 10 --enable-antipatterns

Vim Keypress Analyzer

Key presses per mode (total: 82841)
│─────────────────│───────│───────────│
│ IDENTIFIER (4)  │ COUNT │ SHARE (%) │
│─────────────────│───────│───────────│
│ insert          │ 37.4K │     45.24 │
│ normal          │ 32.4K │     39.14 │
│ visual          │  8.5K │     10.27 │
│ command         │  4.4K │      5.35 │
│─────────────────│───────│───────────│

Key presses excluding [insert, command] modes (total: 40935)
│──────────────────│───────│───────────│
│ IDENTIFIER (10)  │ COUNT │ SHARE (%) │
│──────────────────│───────│───────────│
│ w                │  5.9K │     14.43 │
│ <space>          │  3.6K │      8.83 │
│ j                │  2.6K │      6.55 │
│ k                │  2.2K │      5.45 │
│ b                │  2.3K │      4.97 │
│ d                │  1.2K │      3.15 │
│ e                │  1.2K │      3.07 │
│ <esc>            │  1.1K │      2.69 │
│ i                │  1.7K │      2.63 │
│ c                │  1.4K │      2.55 │
│──────────────────│───────│───────────│

Found Antipatterns
│───────────────│───────│───────────────────│─────────────────────────│
│ PATTERN (15)  │ COUNT │ TOTAL KEY PRESSES │ AVG KEYS PER OCCURRENCE │
│───────────────│───────│───────────────────│─────────────────────────│
│ www+          │   477 │              2.5K │ 5.29                    │
│ bbb+          │   267 │              1.2K │ 4.73                    │
│ ko            │   171 │               342 │ 2.00                    │
│ li            │   120 │               240 │ 2.00                    │
│ jjj+          │   104 │               473 │ 4.55                    │
│ eee+          │   103 │               555 │ 5.39                    │
│ kkk+          │    90 │               427 │ 4.74                    │
│ jO            │    47 │                94 │ 2.00                    │
│ xxx+          │    25 │                96 │ 3.84                    │
│ hhh+          │    22 │               112 │ 5.09                    │
│ dddd+         │    19 │                86 │ 4.53                    │
│ lll+          │    19 │               127 │ 6.68                    │
│ ha            │     8 │                16 │ 2.00                    │
│ XXX+          │     1 │                 6 │ 6.00                    │
│ BBB+          │     1 │                 3 │ 3.00                    │
│───────────────│───────│───────────────────│─────────────────────────│
```

## Features

- [x] count total keys pressed by mode (NORMAL, INSERT, VISUAL, COMMAND)
- [x] count key presses for each key (excludable modes, e.g. don't show
  `insert` mode key presses)
- [x] detect repetitive key sequences as antipatterns (e.g. `jjj` or `dddd`)
  - [ ] detect repetitive multi key sequences like `dwdwdwdw`


## Install

### Binary from GitHub release

1. Download the archive for your OS (OSX and Linux, OSX is not tested yet) from the [releases page](https://github.com/phux/vim-keypress-analyzer/releases)
1. Extract the binary `vim-keypress-analyzer` to a directory in your `$PATH`

## Usage

### Collecting keypresses in vim/nvim

1. start vim with the `-w <path/to/logfile>` flag (see `:h -w`) to tracking
   your key presses
1. edit files/text
1. quit vim. This will create or append the `<path/to/logfile>` with the
   keys you have pressed in the session

Helpful alias to always log your keys:

```sh

alias n='nvim -w ~/.nvim_keylog "$@"'
# or
alias v='vim -w ~/.vim_keylog "$@"'
```

If you want to split the logs per day, to track progress for example:

```sh
# necessary once
mkdir ~/.vim_logs

# automatically write to ~/.vim_logs/YYYY-MM-DD.log
alias n='nvim -w ~/.vim_logs/$(date -Idate).log "$@"'
# or
alias v='vim -w ~/.vim_logs/$(date -Idate).log "$@"'
```

### Analyzing logfiles

There is only a single mandatory option: `-f`\`--file` to the log file generated in the previous step.

```sh
$ vim-keypress-analyzer -f <a_log_file>
```

### Optional flags

| Flag                          | Description                                                          | Possible values              | Default          |
|-------------------------------|----------------------------------------------------------------------|------------------------------|------------------|
| `-l`, `--limit`               | limit the number of key presses displayed                            | any positive int             | `0` (unlimited)  |
| `-a`, `--enable-antipatterns` | boolean flag, enable a rudimentary antipattern analysis              | flag is present or not       | false            |
| `-e`, `--exclude-modes`       | comma separated list of modes to be excluded from the key press list | insert,normal,command,visual | `insert,command` |

## Motivation

- be able to see the ratio of typing in `insert` mode vs. other modes
  - if you are typing 99.9% of the time in `insert` mode, there is not much reason to use vim
- count the characters you type in vim (e.g. per day)
- identify your most pressed keys in non-insert modes, to check for example for
  optimization potential
- identify antipatterns in your editing habit. Antipatterns means repetitive or inefficient key strokes.
  For example, pressing eight times `j` repetitively is considered an
  antipattern. Similarly, pressing `A<cr>` can be done as well by `o`

## TODO

- [ ] rewrite antipattern detection [WIP]
  - [ ] configurable via yaml file
- [ ] option to store results in a structured format (json e.g.)
- [ ] (maybe) `<leader><key>` detection? - the numbers are otherwise not 100% correct
- [ ] (maybe maybe) build a vim plugin that logs keys on the fly to a structured log format
