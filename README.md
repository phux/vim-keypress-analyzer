# Vim Keypress Analyzer

vim-keypress-analyzer parses a vim keypress log file generated by `(n)vim -w <a_log_file>` and aggregates key press counts.

## Features

- [x] count keys pressed by operating mode (NORMAL, INSERT, VISUAL, COMMAND)
- [x] count key frequencies (only when not in INSERT mode)
- [x] identify ALT mappings (e.g. `<m-l>`)
- [ ] key sequence analysis (e.g. `jjj`)
  - [x] analyze for 2-key antipatterns like `jj` or `li` (= `a`)
    - [x] naive approach done
    - Note: `www` will be counted as 2x `ww` in the statistic
  - [ ] more complex patterns `jjjjjj` (= `5j`) or `dddd` (= `dj`)

### TODO

- [ ] (maybe) `<leader><key>` detection?
- [ ] (maybe maybe) build a vim plugin that logs keys and log on the fly to a structured log format

## Example output

```sh
$ vim-keypress-analyzer --file ~/.nvim_keylog --limit 10 --enable-antipatterns

Vim Keypress Analyzer

Key presses per mode (total: 29581)
│─────────────────│───────│───────────│
│ IDENTIFIER (4)  │ COUNT │ SHARE (%) │
│─────────────────│───────│───────────│
│ insert          │ 14.6K │     49.42 │
│ normal          │ 11.1K │     37.69 │
│ visual          │  3.1K │     10.56 │
│ command         │   689 │      2.33 │
│─────────────────│───────│───────────│

Key presses excluding insert mode (total: 14961)
│──────────────────│───────│───────────│
│ IDENTIFIER (10)  │ COUNT │ SHARE (%) │
│──────────────────│───────│───────────│
│ w                │  2.3K │     15.70 │
│ <space>          │  1.2K │      8.65 │
│ j                │   945 │      6.32 │
│ k                │   819 │      5.47 │
│ b                │   718 │      4.80 │
│ d                │   492 │      3.29 │
│ e                │   449 │      3.00 │
│ c                │   402 │      2.69 │
│ i                │   376 │      2.51 │
│ o                │   374 │      2.50 │
│──────────────────│───────│───────────│

Found Antipatterns
│───────────────│───────│
│ PATTERN (12)  │ COUNT │
│───────────────│───────│
│ ww            │   753 │
│ bb            │   338 │
│ kk            │   150 │
│ jj            │   116 │
│ ko            │    86 │
│ hh            │    56 │
│ li            │    52 │
│ ll            │    48 │
│ ee            │    27 │
│ jO            │    24 │
│ ha            │     2 │
│ WW            │     1 │
│───────────────│───────│
```

## Install

### Binary from GitHub release

1. Download the archive for your OS (OSX and Linux, OSX is not tested yet) from the [releases page](https://github.com/phux/vim-keypress-analyzer/releases)
1. Extract the binary `vim-keypress-analyzer` to a directory in your `$PATH`

## Collecting keypresses in vim/nvim

Execute (n)vim with the `-w path/to/logfile` (see `:h -w`) flag to generate
a keypress log file.
Note: the file is only written on exiting (n)vim.

Helpful alias to always log your keys:

```sh
alias n='nvim -w ~/.nvim_keylog "$@"'
# or
alias v='vim -w ~/.vim_keylog "$@"'
```

If you want to split the logs per day, to track progress for example:

```sh
mkdir ~/.vim_logs

alias n='nvim -w ~/.vim_logs/$(date -Idate).log "$@"'
# or
alias v='vim -w ~/.vim_logs/$(date -Idate).log "$@"'
```

## Usage

```sh
$ vim-keypress-analyzer -f <a_log_file>
```

### Optional flags

| Flag                          | Description                                                          | Possible values              | Default         |
|-------------------------------|----------------------------------------------------------------------|------------------------------|-----------------|
| `-l`, `--limit`               | limit the number of key presses displayed                            | any positive int             | `0` (unlimited) |
| `-a`, `--enable-antipatterns` | boolean flag, enable a rudimentary antipattern analysis              | flag is present or not       | false           |
| `-e`, `--exclude-modes`       | comma separated list of modes to be excluded from the key press list | insert,normal,command,visual | `insert`        |
