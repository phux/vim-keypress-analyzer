# Vim Keypress Analyzer

vim-keypress-analyzer parses a vim keypress log file generated by `(n)vim -w <a_log_file>` and aggregates key press counts.

## Features

- [x] count keys pressed by operating mode (NORMAL, INSERT, VISUAL, COMMAND)
- [x] count key frequencies (only when not in INSERT mode)
- [x] identify ALT mappings (e.g. `<m-l>`)
- [x] detect repetitive key sequences as antipatterns (e.g. `jjj` or `dddd`)
  - [ ] detect repetitive multi key sequences like `dwdwdwdw`

### TODO

- [ ] (maybe) `<leader><key>` detection?
- [ ] (maybe maybe) build a vim plugin that logs keys and log on the fly to a structured log format

## Example output

```sh
$ vim-keypress-analyzer --file ~/.nvim_keylog --limit 10 --enable-antipatterns

Vim Keypress Analyzer

Key presses per mode (total: 32458)
│─────────────────│───────│───────────│
│ IDENTIFIER (4)  │ COUNT │ SHARE (%) │
│─────────────────│───────│───────────│
│ insert          │ 15.7K │     48.58 │
│ normal          │ 12.4K │     38.37 │
│ visual          │  3.4K │     10.68 │
│ command         │   768 │      2.37 │
│─────────────────│───────│───────────│

Key presses excluding insert mode (total: 16691)
│──────────────────│───────│───────────│
│ IDENTIFIER (10)  │ COUNT │ SHARE (%) │
│──────────────────│───────│───────────│
│ w                │  2.6K │     15.74 │
│ <space>          │  1.4K │      8.63 │
│ j                │  1.6K │      6.38 │
│ k                │   901 │      5.40 │
│ b                │   840 │      5.03 │
│ d                │   561 │      3.36 │
│ e                │   502 │      3.01 │
│ c                │   447 │      2.68 │
│ i                │   427 │      2.56 │
│ o                │   408 │      2.44 │
│──────────────────│───────│───────────│

Found Antipatterns
│───────────────│───────│
│ PATTERN (15)  │ COUNT │
│───────────────│───────│
│ www+          │   221 │
│ bbb+          │   102 │
│ ko            │    94 │
│ li            │    59 │
│ kkk+          │    41 │
│ eee+          │    40 │
│ jjj+          │    40 │
│ jO            │    24 │
│ hhh+          │    13 │
│ lll+          │    11 │
│ dddd+         │     9 │
│ xxx+          │     9 │
│ ha            │     4 │
│ BBB+          │     1 │
│ XXX+          │     1 │
│───────────────│───────│
```

## Install

### Binary from GitHub release

1. Download the archive for your OS (OSX and Linux, OSX is not tested yet) from the [releases page](https://github.com/phux/vim-keypress-analyzer/releases)
1. Extract the binary `vim-keypress-analyzer` to a directory in your `$PATH`

## Collecting keypresses in vim/nvim

Execute (n)vim with the `-w path/to/logfile` (see `:h -w`) flag to generate
a keypress log file.
Note: the file is only written on exiting (n)vim.

Helpful alias to always log your keys:

```sh
alias n='nvim -w ~/.nvim_keylog "$@"'
# or
alias v='vim -w ~/.vim_keylog "$@"'
```

If you want to split the logs per day, to track progress for example:

```sh
mkdir ~/.vim_logs

alias n='nvim -w ~/.vim_logs/$(date -Idate).log "$@"'
# or
alias v='vim -w ~/.vim_logs/$(date -Idate).log "$@"'
```

## Usage

```sh
$ vim-keypress-analyzer -f <a_log_file>
```

### Optional flags

| Flag                          | Description                                                          | Possible values              | Default         |
|-------------------------------|----------------------------------------------------------------------|------------------------------|-----------------|
| `-l`, `--limit`               | limit the number of key presses displayed                            | any positive int             | `0` (unlimited) |
| `-a`, `--enable-antipatterns` | boolean flag, enable a rudimentary antipattern analysis              | flag is present or not       | false           |
| `-e`, `--exclude-modes`       | comma separated list of modes to be excluded from the key press list | insert,normal,command,visual | `insert`        |
