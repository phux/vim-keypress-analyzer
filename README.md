# Vim Keypress Analyzer

`vim-keypress-analyzer` parses vim keypress log files generated by
`(n)vim -w <a_log_file>` and aggregates key press counts and some antipattern analysis.

## Table of contents

* [Motivation](#motivation)
* [Features](#features)
  * [TODO](#todo)
* [Example output](#example-output)
* [Install](#install)
  * [Binary from GitHub release](#binary-from-github-release)
* [Usage](#usage)
  * [Collecting keypresses in vim/nvim](#collecting-keypresses-in-vim/nvim)
  * [Analyzing logfiles](#analyzing-logfiles)
  * [Optional flags](#optional-flags)

## Motivation

- be able to see the ratio of typing in `insert` mode vs. other modes
  - if you are typing 99.9% of the time in `insert` mode, there is not much reason to use vim
- count the characters you type in vim (e.g. per day)
- identify your most pressed keys in non-insert modes, to check for example for
  optimization potential
- identify antipatterns in your editing habit. Antipatterns means repetitive or inefficient key strokes.
  For example, pressing eight times `j` repetitively is considered an
  antipattern. Similarly, pressing `A<cr>` can be done as well by `o`

## Features

- [x] count total keys pressed by mode (NORMAL, INSERT, VISUAL, COMMAND)
- [x] count key presses for each key (excludable modes, e.g. don't show
  `insert` mode key presses)
- [x] detect repetitive key sequences as antipatterns (e.g. `jjj` or `dddd`)
  - [ ] detect repetitive multi key sequences like `dwdwdwdw`

### TODO

- [ ] (maybe) `<leader><key>` detection?
- [ ] (maybe maybe) build a vim plugin that logs keys on the fly to a structured log format

## Example output

```sh
$ vim-keypress-analyzer --file ~/.nvim_keylog --limit 10 --enable-antipatterns

Vim Keypress Analyzer

Key presses per mode (total: 74478)
│─────────────────│───────│───────────│
│ IDENTIFIER (4)  │ COUNT │ SHARE (%) │
│─────────────────│───────│───────────│
│ insert          │ 34.5K │     46.40 │
│ normal          │ 28.4K │     37.66 │
│ visual          │  7.6K │     10.24 │
│ command         │  4.2K │      5.71 │
│─────────────────│───────│───────────│

Key presses excluding [insert, command] modes (total: 35672)
│──────────────────│───────│───────────│
│ IDENTIFIER (10)  │ COUNT │ SHARE (%) │
│──────────────────│───────│───────────│
│ w                │  5.3K │     14.94 │
│ <space>          │  3.2K │      9.21 │
│ j                │  2.3K │      6.46 │
│ k                │  1.9K │      5.34 │
│ b                │  1.7K │      4.96 │
│ d                │  1.1K │      3.21 │
│ e                │  1.2K │      2.86 │
│ <esc>            │  1.0K │      2.80 │
│ i                │   917 │      2.57 │
│ c                │   902 │      2.53 │
│──────────────────│───────│───────────│

Found Antipatterns
│───────────────│───────│───────────────────│─────────────────────────│
│ PATTERN (15)  │ COUNT │ TOTAL KEY PRESSES │ AVG KEYS PER OCCURRENCE │
│───────────────│───────│───────────────────│─────────────────────────│
│ www+          │   427 │              2.2K │ 5.33                    │
│ bbb+          │   234 │              1.8K │ 4.63                    │
│ ko            │   153 │               306 │ 2.00                    │
│ li            │   110 │               220 │ 2.00                    │
│ jjj+          │    86 │               389 │ 4.52                    │
│ eee+          │    82 │               426 │ 5.20                    │
│ kkk+          │    80 │               357 │ 4.46                    │
│ jO            │    42 │                84 │ 2.00                    │
│ xxx+          │    23 │                91 │ 3.96                    │
│ hhh+          │    20 │               105 │ 5.25                    │
│ lll+          │    19 │               127 │ 6.68                    │
│ dddd+         │    17 │                74 │ 4.35                    │
│ ha            │     9 │                18 │ 2.00                    │
│ XXX+          │     1 │                 6 │ 6.00                    │
│ BBB+          │     1 │                 3 │ 3.00                    │
│───────────────│───────│───────────────────│─────────────────────────│
```

## Install

### Binary from GitHub release

1. Download the archive for your OS (OSX and Linux, OSX is not tested yet) from the [releases page](https://github.com/phux/vim-keypress-analyzer/releases)
1. Extract the binary `vim-keypress-analyzer` to a directory in your `$PATH`

## Usage

### Collecting keypresses in vim/nvim

1. start vim with the `-w <path/to/logfile>` flag (see `:h -w`) to tracking
   your key presses
1. edit files/text
1. quit vim. This will create or append the `<path/to/logfile>` with the
   keys you have pressed in the session

Helpful alias to always log your keys:

```sh

alias n='nvim -w ~/.nvim_keylog "$@"'
# or
alias v='vim -w ~/.vim_keylog "$@"'
```

If you want to split the logs per day, to track progress for example:

```sh
# necessary once
mkdir ~/.vim_logs

# automatically write to ~/.vim_logs/YYYY-MM-DD.log
alias n='nvim -w ~/.vim_logs/$(date -Idate).log "$@"'
# or
alias v='vim -w ~/.vim_logs/$(date -Idate).log "$@"'
```

### Analyzing logfiles
```sh
$ vim-keypress-analyzer -f <a_log_file>
```

### Optional flags

| Flag                          | Description                                                          | Possible values              | Default          |
|-------------------------------|----------------------------------------------------------------------|------------------------------|------------------|
| `-l`, `--limit`               | limit the number of key presses displayed                            | any positive int             | `0` (unlimited)  |
| `-a`, `--enable-antipatterns` | boolean flag, enable a rudimentary antipattern analysis              | flag is present or not       | false            |
| `-e`, `--exclude-modes`       | comma separated list of modes to be excluded from the key press list | insert,normal,command,visual | `insert,command` |
